import { Button, InputEmail, InputNumber, InputPassword, InputText } from "@neuralbertatech/react";
import { useEffect, useState } from "react";

import Head from "next/head";
import type { InputState } from "@neuralbertatech/react/lib/components/input/InputBase";
import type { NextPage } from "next";

interface Form {
  name: InputState<string>;
  email: InputState<string>;
  password: InputState<string>;
  age: InputState<number>;
}

const Home: NextPage = () => {
  const [form, setForm] = useState<Form>({
    name: "",
    email: "",
    password: "",
    age: 0,
  });
  const [disableButton, setDisableButton] = useState(true);

  useEffect(() => {
    setForm(form);
    setDisableButton(Object.values(form)
      .some(value => value.current?.getState().valid === false));
  }, [form]);

  const setFormField = <T,>(field: keyof Form, value: T) => {
    const temp = { ...form };
    temp[field] = value;
    setForm(temp);
  };

  return (
    <div>
      <Head>
        <title>Form</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <main style={{
        width: "100vw",
        height: "100vh"
      }}>
        <form>
          <InputText
            label="Name"
            name="name"
            placeholder="Boaty McBoatface"
            onChange={(value, valid) => {
              if (valid === true) {
                setFormField("name", value);
              }
            }}
            validation={/\w+\s\w+/}
            icon={<span>üîç</span>}
            required
          />
          <InputEmail
            label="Email"
            name="email"
            placeholder="example@neuralberta.tech"
            onChange={(value, valid) => {
              if (valid === true) {
                setFormField("email", value);
              }
            }}
            required
          />
          <InputPassword
            label="Password"
            name="password"
            placeholder="example@neuralberta.tech"
            onChange={(value, valid) => {
              if (valid === true) {
                setFormField("password", value);
              }
            }}
            required
          />
          <InputNumber
            label="Age"
            name="age"
            placeholder="Email" min={0} max={5}
            onChange={(value, valid) => {
              if (valid === true) {
                setFormField("age", value);
              }
            }}
            required />
        </form>
        <Button text="Log" onClick={() => console.table(form)} disabled={disableButton} />
      </main>
    </div>
  );
};

export default Home;
